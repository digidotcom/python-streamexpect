<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Getting Started &mdash; streamexpect 0.2.0 documentation</title>
    
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.2.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="streamexpect 0.2.0 documentation" href="index.html" />
    <link rel="next" title="API Documentation" href="api.html" />
    <link rel="prev" title="streamexpect" href="index.html" />
   
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body role="document">  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="getting-started">
<h1><a class="toc-backref" href="#id1">Getting Started</a><a class="headerlink" href="#getting-started" title="Permalink to this headline">¶</a></h1>
<div class="contents topic" id="contents">
<p class="topic-title first">Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#getting-started" id="id1">Getting Started</a><ul>
<li><a class="reference internal" href="#installation" id="id2">Installation</a></li>
<li><a class="reference internal" href="#the-streamexpect-wrap-function" id="id3">The <em>streamexpect.wrap</em> Function</a></li>
<li><a class="reference internal" href="#text-vs-binary" id="id4">Text vs. Binary</a></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="installation">
<h2><a class="toc-backref" href="#id2">Installation</a><a class="headerlink" href="#installation" title="Permalink to this headline">¶</a></h2>
<p>streamexpect may be installed directly from <a class="reference external" href="https://pypi.python.org/pypi/streamexpect">PyPi</a> using <a class="reference external" href="https://pip.pypa.io/en/stable/">pip</a>:</p>
<div class="highlight-python"><div class="highlight"><pre>pip install streamexpect
</pre></div>
</div>
<p>This will install the library as well as any dependency libraries.</p>
<p>The library is tested to work on the following Python versions:</p>
<ul class="simple">
<li>Python 2.7</li>
<li>Python 3.3</li>
<li>Python 3.4</li>
<li>Python 3.5</li>
<li>PyPy</li>
<li>PyPy3</li>
</ul>
</div>
<div class="section" id="the-streamexpect-wrap-function">
<h2><a class="toc-backref" href="#id3">The <em>streamexpect.wrap</em> Function</a><a class="headerlink" href="#the-streamexpect-wrap-function" title="Permalink to this headline">¶</a></h2>
<p>streamexpect provides a convenience function that does much of the setup and
configuration of the streamexpect types, returning to the user an easy-to-use
wrapper over the provided stream. A common use case is communicating with a
remote socket using a simple text-based protocol. In this case, we&#8217;ll use
streamexpect to talk to Google:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">socket</span>
<span class="kn">import</span> <span class="nn">streamexpect</span>

<span class="n">sock</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SOCK_STREAM</span><span class="p">)</span>
<span class="n">sock</span><span class="o">.</span><span class="n">connect</span><span class="p">((</span><span class="s1">&#39;www.google.com&#39;</span><span class="p">,</span> <span class="mi">80</span><span class="p">))</span>

<span class="c1"># By default, this will open in binary mode. To read a non-ASCII text stream,</span>
<span class="c1"># the unicode option needs to be enabled.</span>
<span class="k">with</span> <span class="n">streamexpect</span><span class="o">.</span><span class="n">wrap</span><span class="p">(</span><span class="n">sock</span><span class="p">)</span> <span class="k">as</span> <span class="n">stream</span><span class="p">:</span>

    <span class="c1"># Send the request. This is passed to the underlying socket.</span>
    <span class="n">stream</span><span class="o">.</span><span class="n">sendall</span><span class="p">(</span><span class="n">b</span><span class="s1">&#39;GET / HTTP/1.1</span><span class="se">\r\n</span><span class="s1">Host: www.google.com</span><span class="se">\r\n\r\n</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="c1"># Find the start of the response.</span>
    <span class="n">stream</span><span class="o">.</span><span class="n">expect_bytes</span><span class="p">(</span><span class="n">b</span><span class="s1">&#39;HTTP/1.1 200 OK</span><span class="se">\r\n</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="c1"># Find the &quot;Date&quot; header using regex groups and print it.</span>
    <span class="n">match</span> <span class="o">=</span> <span class="n">stream</span><span class="o">.</span><span class="n">expect_regex</span><span class="p">(</span><span class="n">br</span><span class="s1">&#39;Date: ([^</span><span class="se">\r\n</span><span class="s1">]+)</span><span class="se">\r\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">u&#39;Google says the date/time is &#39;</span> <span class="o">+</span> <span class="n">match</span><span class="o">.</span><span class="n">groups</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;ascii&#39;</span><span class="p">))</span>
</pre></div>
</div>
<p>streamexpect also provides intelligent support for Unicode in both Python 2
and Python 3. When using the <a class="reference internal" href="api.html#streamexpect.wrap" title="streamexpect.wrap"><code class="xref py py-func docutils literal"><span class="pre">streamexpect.wrap()</span></code></a> function, all that is
needed to enable Unicode support is the <code class="docutils literal"><span class="pre">unicode=True</span></code> flag:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">io</span>
<span class="kn">import</span> <span class="nn">streamexpect</span>

<span class="n">unicode_stream</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">StringIO</span><span class="p">(</span><span class="s1">u&#39;¡Se puede con español!&#39;</span><span class="p">)</span>

<span class="k">with</span> <span class="n">streamexpect</span><span class="o">.</span><span class="n">wrap</span><span class="p">(</span><span class="n">unicode_stream</span><span class="p">,</span> <span class="nb">unicode</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span> <span class="k">as</span> <span class="n">stream</span><span class="p">:</span>
    <span class="n">match</span> <span class="o">=</span> <span class="n">stream</span><span class="o">.</span><span class="n">expect_text</span><span class="p">(</span><span class="s1">u&#39;español&#39;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">match</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">u&#39;Found {} at index {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">match</span><span class="p">,</span> <span class="n">match</span><span class="o">.</span><span class="n">start</span><span class="p">))</span>
</pre></div>
</div>
<p>Another common streamexpect use case is for interacting with PySerial.  Since
streamexpect does not require that the underlying stream define an actual
file, it is even possible to use streamexpect with PySerial on Windows!</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c1"># Send the uname command to a Linux PC connected to a Windows PC over serial</span>
<span class="kn">import</span> <span class="nn">serial</span>
<span class="kn">import</span> <span class="nn">streamexpect</span>

<span class="c1"># timeout=0 is essential, as streams are required to be non-blocking</span>
<span class="n">ser</span> <span class="o">=</span> <span class="n">serial</span><span class="o">.</span><span class="n">Serial</span><span class="p">(</span><span class="s1">&#39;COM1&#39;</span><span class="p">,</span> <span class="n">baudrate</span><span class="o">=</span><span class="mi">115200</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="k">with</span> <span class="n">streamexpect</span><span class="o">.</span><span class="n">wrap</span><span class="p">(</span><span class="n">ser</span><span class="p">)</span> <span class="k">as</span> <span class="n">stream</span><span class="p">:</span>
    <span class="n">stream</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">b</span><span class="s1">&#39;</span><span class="se">\r\n</span><span class="s1">uname -a</span><span class="se">\r\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">match</span> <span class="o">=</span> <span class="n">stream</span><span class="o">.</span><span class="n">expect_bytes</span><span class="p">(</span><span class="n">b</span><span class="s1">&#39;Linux&#39;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">u&#39;Found Linux at index {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">start</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="section" id="text-vs-binary">
<h2><a class="toc-backref" href="#id4">Text vs. Binary</a><a class="headerlink" href="#text-vs-binary" title="Permalink to this headline">¶</a></h2>
<p>Much like Python 3, streamexpect takes a very explicit stance on what is text
and what is binary. This position carries over to streamexpect even when used
with Python 2, and therefore may catch some users unaware.</p>
<p>Simply stated, if a stream type returns the <code class="docutils literal"><span class="pre">str</span></code> type in Python 2 or the
<code class="docutils literal"><span class="pre">bytes</span></code> type in Python 3, it is treated as a binary stream. In this case,
only binary may be provided to the <code class="xref py py-func docutils literal"><span class="pre">Expecter.expect()</span></code> method. Likewise,
if a stream type returns the <code class="docutils literal"><span class="pre">unicode</span></code> type in Python 2 or the <code class="docutils literal"><span class="pre">str</span></code> type
in Python 3, only text may be provided <code class="xref py py-func docutils literal"><span class="pre">Expecter.expect()</span></code> method.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">streamexpect</a></h1>





<p>
<iframe src="https://ghbtns.com/github-btn.html?user=digidotcom&repo=python-streamexpect&type=watch&count=true&size=large"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>




<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="">Getting Started</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#installation">Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#the-streamexpect-wrap-function">The <em>streamexpect.wrap</em> Function</a></li>
<li class="toctree-l2"><a class="reference internal" href="#text-vs-binary">Text vs. Binary</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="api.html">API Documentation</a></li>
</ul>


<hr />
<ul>
    
    <li class="toctree-l1"><a href="http://www.digi.com/wds/">Digi Wireless Design</a></li>
    
    <li class="toctree-l1"><a href="https://github.com/digidotcom/python-streamexpect">Streamexpect on Github</a></li>
    
</ul>

<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2015, Digi International, Inc..
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.3.4</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.7</a>
      
      |
      <a href="_sources/getting_started.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>